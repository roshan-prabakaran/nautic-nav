{% extends "base.html" %}

{% block content %}
<div class="reports-page">
    <div class="page-header">
        <h1>Analytics & Reports</h1>
        <div class="report-controls">
            <select id="report-type" class="form-select">
                <option value="daily">Daily Report</option>
                <option value="weekly">Weekly Report</option>
                <option value="monthly">Monthly Report</option>
            </select>
            <button id="generate-report" class="btn btn-primary">
                <i class="fas fa-file-pdf"></i> Generate Report
            </button>
        </div>
    </div>

    <div class="reports-grid">
        <div class="report-card">
            <div class="card-header">
                <h3>Vessel Activity Summary</h3>
            </div>
            <div class="card-content">
                <canvas id="vesselActivityChart"></canvas>
            </div>
        </div>

        <div class="report-card">
            <div class="card-header">
                <h3>Environmental Trends</h3>
            </div>
            <div class="card-content">
                <canvas id="environmentalChart"></canvas>
            </div>
        </div>

        <div class="report-card">
            <div class="card-header">
                <h3>Alert Statistics</h3>
            </div>
            <div class="card-content">
                <canvas id="alertsChart"></canvas>
            </div>
        </div>

        <div class="report-card">
            <div class="card-header">
                <h3>Route Optimization</h3>
            </div>
            <div class="card-content">
                <div class="optimization-metrics">
                    <div class="metric">
                        <span class="metric-value">23%</span>
                        <span class="metric-label">Fuel Savings</span>
                    </div>
                    <div class="metric">
                        <span class="metric-value">15min</span>
                        <span class="metric-label">Time Saved</span>
                    </div>
                    <div class="metric">
                        <span class="metric-value">8</span>
                        <span class="metric-label">Routes Optimized</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="detailed-reports">
        <h2>Detailed Analysis</h2>
        <div class="analysis-tabs">
            <button class="tab-btn active" data-tab="performance">Performance</button>
            <button class="tab-btn" data-tab="safety">Safety</button>
            <button class="tab-btn" data-tab="environmental">Environmental</button>
        </div>
        
        <div class="tab-content">
            <div id="performance-tab" class="tab-pane active">
                <div class="performance-metrics">
                    <h3>Fleet Performance Metrics</h3>
                    <table class="metrics-table">
                        <thead>
                            <tr>
                                <th>Vessel</th>
                                <th>Efficiency Score</th>
                                <th>Fuel Consumption</th>
                                <th>Route Adherence</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody id="performance-table-body">
                        </tbody>
                    </table>
                </div>
            </div>
            
            <div id="safety-tab" class="tab-pane">
                <div class="safety-metrics">
                    <h3>Safety Analysis</h3>
                    <div class="safety-grid">
                        <div class="safety-item">
                            <h4>Collision Risks</h4>
                            <div class="risk-level low">Low Risk</div>
                        </div>
                        <div class="safety-item">
                            <h4>Weather Warnings</h4>
                            <div class="risk-level medium">Medium Risk</div>
                        </div>
                        <div class="safety-item">
                            <h4>Navigation Hazards</h4>
                            <div class="risk-level low">Low Risk</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div id="environmental-tab" class="tab-pane">
                <div class="environmental-metrics">
                    <h3>Environmental Impact</h3>
                    <div class="impact-summary">
                        <p>Carbon footprint reduced by <strong>18%</strong> this month</p>
                        <p>Marine protected areas compliance: <strong>100%</strong></p>
                        <p>Waste discharge incidents: <strong>0</strong></p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    let vesselActivityChart, environmentalChart, alertsChart;

    document.addEventListener('DOMContentLoaded', function() {
        initReportCharts();
        loadReportData();
        initTabs();
        
        document.getElementById('generate-report').addEventListener('click', generateReport);
    });

    function initReportCharts() {
        // Vessel Activity Chart
        const vesselCtx = document.getElementById('vesselActivityChart').getContext('2d');
        vesselActivityChart = new Chart(vesselCtx, {
            type: 'doughnut',
            data: {
                labels: ['Cargo', 'Tanker', 'Fishing', 'Passenger', 'Tug'],
                datasets: [{
                    data: [35, 25, 20, 15, 5],
                    backgroundColor: ['#e74c3c', '#f39c12', '#27ae60', '#3498db', '#9b59b6']
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        position: 'bottom'
                    }
                }
            }
        });

        // Environmental Chart
        const envCtx = document.getElementById('environmentalChart').getContext('2d');
        environmentalChart = new Chart(envCtx, {
            type: 'line',
            data: {
                labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                datasets: [{
                    label: 'Water Quality',
                    data: [85, 87, 82, 89, 91, 88],
                    borderColor: '#3498db',
                    tension: 0.4
                }, {
                    label: 'Air Quality',
                    data: [78, 82, 85, 83, 87, 89],
                    borderColor: '#27ae60',
                    tension: 0.4
                }]
            },
            options: {
                responsive: true,
                scales: {
                    y: {
                        beginAtZero: false,
                        min: 70,
                        max: 100
                    }
                }
            }
        });

        // Alerts Chart
        const alertsCtx = document.getElementById('alertsChart').getContext('2d');
        alertsChart = new Chart(alertsCtx, {
            type: 'bar',
            data: {
                labels: ['Collision Risk', 'Weather', 'Pollution', 'Navigation'],
                datasets: [{
                    label: 'Alert Count',
                    data: [12, 8, 5, 3],
                    backgroundColor: ['#e74c3c', '#f39c12', '#e67e22', '#95a5a6']
                }]
            },
            options: {
                responsive: true,
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });
    }

    function loadReportData() {
        // Load performance data
        const performanceData = [
            { vessel: 'Vessel A', efficiency: 92, fuel: '245 L/h', adherence: '98%', status: 'Excellent' },
            { vessel: 'Vessel B', efficiency: 87, fuel: '289 L/h', adherence: '95%', status: 'Good' },
            { vessel: 'Vessel C', efficiency: 94, fuel: '198 L/h', adherence: '99%', status: 'Excellent' },
            { vessel: 'Vessel D', efficiency: 83, fuel: '312 L/h', adherence: '92%', status: 'Fair' }
        ];

        const tbody = document.getElementById('performance-table-body');
        tbody.innerHTML = '';

        performanceData.forEach(data => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${data.vessel}</td>
                <td>${data.efficiency}%</td>
                <td>${data.fuel}</td>
                <td>${data.adherence}</td>
                <td><span class="status ${data.status.toLowerCase()}">${data.status}</span></td>
            `;
            tbody.appendChild(row);
        });
    }

    function initTabs() {
        const tabBtns = document.querySelectorAll('.tab-btn');
        const tabPanes = document.querySelectorAll('.tab-pane');

        tabBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                const tabId = btn.dataset.tab;
                
                tabBtns.forEach(b => b.classList.remove('active'));
                tabPanes.forEach(p => p.classList.remove('active'));
                
                btn.classList.add('active');
                document.getElementById(tabId + '-tab').classList.add('active');
            });
        });
    }

    function generateReport() {
        const reportType = document.getElementById('report-type').value;
        alert(`Generating ${reportType} report... This would typically download a PDF report.`);
    }
</script>
{% endblock %}
